<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>GSO-8-Trend Analysis</title>
<meta name="identifier" content="g3fdd16556e26668a37a581f90af243e7"/>
<meta name="editing_roles" content="teachers"/>
<meta name="workflow_state" content="active"/>
</head>
<body>
<div><span>GEE has many built-in functions and operations for users to call, and luckily, a linear fit is among them. If you search for Linear in the documentation, we can see that ee.Reducer.linearFit() takes two inputs and returns a reducer.&nbsp;</span>
<div><img role="presentation" src="$IMS-CC-FILEBASE$/Uploaded%20Media/LinFit.png" alt="" loading="lazy"></div>
</div>
<div><span>In this final step, we will perform that trend analysis. &nbsp;To do this, we must add a date time stamp to have the appropriate X value (time) for our Y value (Snow cover frequency).</span></div>
<div>
<div><img src="$IMS-CC-FILEBASE$/Uploaded%20Media/SCFgraph%20(1).png" alt="SCFgraph (1).png" loading="lazy"></div>
<span><br></span></div>
<div><span>To add the date, we will also encompass all the other functions up to this point as well, because we need to format the newly created image collection correctly for the linearFit reducer. &nbsp;We will, therefore, create 3 arrays. &nbsp;One will contain the start dates, one the end dates and the other will be left blank. &nbsp;We will then iterate through the arrays in a for loop, using our previously created functions to calculate snow cover frequency. &nbsp;We will then use the data to create a band of constant value and add to that the snow cover frequency. &nbsp;The code to do this appears as follows...</span></div>
<div><span><img src="$IMS-CC-FILEBASE$/Uploaded%20Media/AddDate.png" alt="AddDate.png" loading="lazy"></span></div>
<div><span>&nbsp;</span></div>
<div>
<div>
<pre>// A function to merge the bands together after a join<br>// the bands are referred to as the 'primary' and 'secondary' properties<br>var MergeBands = function(aRow) {<br>&nbsp; var anImage = ee.Image.cat(aRow.get('primary'), aRow.get('secondary'));<br>&nbsp; return anImage;<br>};<br><br><br>// A function to assign high sensor zenith angle cells to null<br>var CorrectSensorPixels = function(anImage) {<br>&nbsp; var LT25 = anImage.select('SensorZenith').lte(2500); // Angle is stored as angle * 100 in MOD09<br>&nbsp; return anImage.mask(LT25);<br>};<br><br>// A function to reclassify MODIS snow cover products (MOD10A1/A2) values<br>// snow/ice--1; no snow/ice--0; all others--null<br>var Reclassify = function(anImage) {<br>&nbsp; var ClassifiedImage = anImage.remap([100, 200, &nbsp;25, &nbsp;37, &nbsp;39], &nbsp; // Original pixel values from MODIS Snow Products<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ &nbsp;1, &nbsp; 1, &nbsp; 0, &nbsp; 0, &nbsp; 0], &nbsp; // Reclassified values: 1--snow/ice; 0--no snow/ice<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; null, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// All other MODIS snow product pixel values (0, 1, 11, 50, 254, 255)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Snow_Cover_Daily_Tile'); &nbsp; &nbsp;// The band we wish to remap<br>&nbsp; return ClassifiedImage;<br>};<br><br><br>// Prepare MODIS snow cover data for calculating snow cover frequency<br>// Join MOD09 and MOD10, mask out cells with gte 25 sensor-zenith-angle, and reclassify to: 1, 0, null<br>var PrepareModisSnowCover = function(StartDate, EndDate) {<br>&nbsp; // Create MOD09GA and MOD10A1 image collections for the time period<br>&nbsp; var MOD09GA = ee.ImageCollection('MOD09GA').select('SensorZenith')<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.filterDate(StartDate, EndDate);<br>&nbsp; var MOD10A1 = ee.ImageCollection('MOD10A1').select('Snow_Cover_Daily_Tile')<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .filterDate(StartDate, EndDate);<br>&nbsp;&nbsp;<br>&nbsp; // Define the join type and filter<br>&nbsp; var innerJoin = ee.Join.inner();<br>&nbsp; var joinFilter = ee.Filter.equals({<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'leftField': 'system:time_start',&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'rightField': 'system:time_start'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });<br><br>&nbsp; // Join the two collections, passing entries through the filter<br>&nbsp; var joinedMods = ee.ImageCollection(innerJoin.apply(MOD09GA, MOD10A1, joinFilter));<br><br>&nbsp; // Map our functions over the Image Collections&nbsp;<br>&nbsp; var FinalModisDataset = joinedMods.map(MergeBands)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map(CorrectSensorPixels)<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map(Reclassify);<br>&nbsp;&nbsp;<br>&nbsp; return FinalModisDataset;<br>};<br><br><br>var CalculateSnowCoverFrequency = function(ModisSnowCover) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// We hand the function our final MODIS dataset<br>&nbsp; var NumOfSnowDays = &nbsp;ModisSnowCover.sum(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Calculate the number of days with snow cover with .sum()<br>&nbsp; var NumOfValidObsDays = ModisSnowCover.count(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Count the number of days with a valid observation with .count()<br>&nbsp; var SnowCoverFrequency = NumOfSnowDays.divide(NumOfValidObsDays); &nbsp; &nbsp; &nbsp; &nbsp; // perform the calculation<br>&nbsp; return SnowCoverFrequency;<br>};<br><br>var WaterYearStartDates = ['2004-10-01','2005-10-01','2006-10-01','2007-10-01','2008-10-01','2009-10-01','2010-10-01','2011-10-01','2012-10-01','2013-10-01'];<br>var WaterYearEndDates = &nbsp; ['2005-09-30','2006-09-30','2007-09-30','2008-09-30','2009-09-30','2010-09-30','2011-09-30','2012-09-30','2013-09-30','2014-09-30'];<br>var WaterYearSCFImages = []; &nbsp; &nbsp; &nbsp;// Create an array to add images to<br><br>for (var i = 0; i &lt; WaterYearStartDates.length; i++) {&nbsp;<br>&nbsp; var SCF = CalculateSnowCoverFrequency( PrepareModisSnowCover(WaterYearStartDates[i], WaterYearEndDates[i]) ); &nbsp; // Remember that PrepareModisSnowCover takes two dates, a start and an end<br>&nbsp; var waterYearSCFImage = &nbsp;ee.Image(new Date(WaterYearEndDates[i]).getFullYear()) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Create an image with a constant value everywhere, that value being the End Year<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.addBands( SCF.select(['remapped'], ['Snow Cover Frequency']) ).toDouble(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Add the Snow Cover Frequency to the newly created image. &nbsp;<br>&nbsp; WaterYearSCFImages.push(waterYearSCFImage);<br>}<br><br>var WaterYearSCFImages = ee.ImageCollection(WaterYearSCFImages); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// We must tell GEE what type of collection this is in order to display it.<br>print(WaterYearSCFImages);<br>Map.addLayer(WaterYearSCFImages);<br><br><br></pre>
</div>
</div>
<div><a href="https://code.earthengine.google.com/2f8365058bbb62ce4f10cbdff4d1d4eb" target="_blank">https://code.earthengine.google.com/2f8365058bbb62ce4f10cbdff4d1d4eb</a>&nbsp;</div>
<div><span>This can be complicated to follow, so understand what we just did. &nbsp;If necessary, you can hand it a single set of dates like this&nbsp;link</span><a class="external" style="font-size: 1rem;" href="https://ee-api.appspot.com/64c25747b74238eb0f0e6f6d14b85c55" target="_blank"><span class="external_link_icon" role="presentation"><span class="screenreader-only" style="display: inline !important;">&nbsp;to an external site.</span></span></a><span>&nbsp;And examine a single image in the collection. &nbsp;Once you are satisfied you understand what we just did, we will then apply the linear fit reducer. This call looks like such.</span></div>
<div>
<div>
<div><span>&nbsp;<img src="$IMS-CC-FILEBASE$/Uploaded%20Media/Capture%20(1).png" alt="Capture (1).png" loading="lazy"></span></div>
<div>Code Snapshot: <a href="https://code.earthengine.google.com/9335f4e9c136231837f320a82f234b7d" target="_blank">https://code.earthengine.google.com/9335f4e9c136231837f320a82f234b7d</a>&nbsp;</div>
<span>After we run our reducer, it returns an image with two bands, one called 'scale' and one called 'offset'. &nbsp;This is&nbsp;Google's&nbsp;terms for 'slope' and 'intercept'. &nbsp;We are interested in the slope, so I added the 'scale' (slope) band&nbsp;to the map. &nbsp;</span><span>Go ahead and run the code from the image directly above. &nbsp;What does the map look like?</span></div>
<div>
<div>
<div><img src="$IMS-CC-FILEBASE$/Uploaded%20Media/BlackMap.png" alt="BlackMap.png" loading="lazy"></div>
<div><a class="external" href="https://ee-api.appspot.com/0b46121265d5524ccd3c0a369d7df0ac" target="_blank"><span class="external_link_icon" role="presentation"><span class="screenreader-only">Links to an external site.</span></span></a></div>
</div>
<div><span>Our m</span><span>ap looks a little black. &nbsp;If you use the inspector (click on the inspector tab in the console panel and then a spot on the map) on an area, you can see why. &nbsp;The range of the slopes is extremely small.</span></div>
</div>
</div>
</body>
</html>