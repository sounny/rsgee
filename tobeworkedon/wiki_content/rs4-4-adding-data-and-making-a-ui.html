<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>RS4 -4- Adding Data and Making a UI</title>
<meta name="identifier" content="g3c5ec43374c40fb46f768f03c1def697"/>
<meta name="editing_roles" content="teachers"/>
<meta name="workflow_state" content="active"/>
</head>
<body>
<ol style="list-style-type: decimal;">
<li>Go to <a href="https://code.earthengine.google.com/" target="_blank">https://code.earthengine.google.com/</a></li>
<li>
<p><span>First, we need to define temporal and spatial variables to filter the datasets, namely the approximate ignition coordinates and start date of the fire.</span></p>
</li>
<li><span>Use the following code:</span></li>
<li>
<pre><span>// Define the location of the fire.<br><strong>var</strong> lon = -117.868;<br><strong>var</strong> lat = 34.241;<br><strong>var</strong> zoom = 9;<br><br>// Filter datasets to a specific date range:<br>// start date of fire.<br><strong>var</strong> inYear = 2020;<br><strong>var</strong> inMonth = 9;<br><strong>var</strong> inDay = 6;</span></pre>
</li>
<li><span><img src="$IMS-CC-FILEBASE$/Uploaded%20Media/Screenshot%202023-11-16%20at%205.54.47%E2%80%AFAM.png" alt="Screenshot 2023-11-16 at 5.54.47 AM.png" data-api-endpoint="https://ufl.instructure.com/api/v1/courses/489224/files/82983778" data-api-returntype="File" loading="lazy"></span></li>
<li>
<p><span>Using the ignition date (September 6, 2020), we can define separate date ranges to filter the active fire and burned area datasets to account for differences in the temporal structure of the datasets—i.e., daily versus monthly. Here we set the temporal filter range for active fire datasets as the two-week period starting from the ignition date and for the burned area dataset as the month of September. The duration variables can be modified according to the fire of interest.</span></p>
</li>
<li>
<pre><span><strong>var</strong> durationAF = 15; // in days<br><strong>var</strong> durationBA = 1; // in months<br><br>// Date range for active fires.<br><strong>var</strong> startDateAF = ee.Date.fromYMD(inYear, inMonth, inDay);<br><strong>var</strong> endDateAF = startDateAF.advance(durationAF, 'day');<br><br>// Date range for burned area.<br><strong>var</strong> startDateBA = ee.Date.fromYMD(inYear, inMonth, 1);<br><strong>var</strong> endDateBA = startDateBA.advance(durationBA, 'month');</span></pre>
</li>
<li><span><img src="$IMS-CC-FILEBASE$/Uploaded%20Media/Screenshot%202023-11-16%20at%205.56.01%E2%80%AFAM.png" alt="Screenshot 2023-11-16 at 5.56.01 AM.png" data-api-endpoint="https://ufl.instructure.com/api/v1/courses/489224/files/82983782" data-api-returntype="File" loading="lazy"></span></li>
<li>
<p><span>With these input variables defined, we can preprocess the fire datasets. We will upload a high-resolution reference perimeter provided by the U.S. National Interagency Fire Center (NIFC) and then add the MODIS and GOES datasets from the Earth Engine data catalog.</span></p>
<strong></strong></li>
<li><strong>Reference Fire Perimeter</strong><span>&nbsp;</span>
<p>&nbsp;</p>
</li>
<li>
<p><span>The NIFC produces wildland fire perimeters using information from local fire agencies. For this Lab, we uploaded the NIFC perimeter for the Bobcat Fire, converting it from a shapefile to an Earth Engine asset. We will access the asset from the book repository and use it as a reference layer to compare with the MODIS and GOES datasets.&nbsp;</span></p>
</li>
<li>
<pre><span>// -------------------------------<br>// 1. Reference Perimeter (WFIGS)<br>// -------------------------------<br>// Note: each fire has multiple versions, so here we are<br>// filtering WFIGS by the name of the fire, sorting the<br>// area of the filtered polygons in descending order,<br>// and retrieving the polygon with the highest area.<br><strong>var</strong> WFIGS = ee.FeatureCollection(<br>  &nbsp; 'users/sounny/WFIGS');<br><strong>var</strong> reference = ee.Feature(WFIGS.filter(ee.Filter.eq('irwin_In_1',<br>&nbsp; &nbsp; &nbsp; &nbsp; 'BOBCAT'))<br>&nbsp; &nbsp; .sort('poly_Acres', <strong>false</strong>).first());</span></pre>
</li>
<li>
<h5><strong>MODIS Active Fire Products</strong></h5>
<p><span>The gridded 1 km MODIS active fire datasets, MOD14A1 (Terra) and MYD14A1 (Aqua), have daily collection rates and global coverage (Giglio et al. 2016; Giglio 2010). The MODIS sensor is mounted on two satellites, Terra and Aqua, operated by NASA for environmental monitoring. Here, we define two functions to process the fire mask and fire radiative power (FRP) variables. The fire mask provides a categorical classification of confidence in fire detection, where values ≥7 indicate that fire is present. FRP is a continuous variable proxy for fire intensity in megawatts (MW) units. Note that MODIS FRP must be multiplied by 0.1 to be in units of MW.</span></p>
</li>
<li>
<pre><span>// -------------------------------<br>// 2. MODIS active fire datasets<br>// -------------------------------<br>// MOD14A1, MYD14A1 = MODIS/Terra and Aqua active fires and thermal anomalies<br>// resolution: daily, gridded at 1km in sinusoidal projection (SR-ORG:6974)<br>// variables: fire mask (FireMask), fire radiative power in MW (MaxFRP)<br>// satellite overpasses: Terra (10:30am/pm local time), Aqua (1:30am/pm local time)<br><br>// Define the Earth Engine paths for MOD14A1 and MYD14A1, collection 6.<br><strong>var</strong> mod14a1 = ee.ImageCollection('MODIS/006/MOD14A1');<br><strong>var</strong> myd14a1 = ee.ImageCollection('MODIS/006/MYD14A1');<br><br>// Filter the datasets according to the date range.<br><strong>var</strong> mod14a1Img = mod14a1.filterDate(startDateAF, endDateAF);<br><strong>var</strong> myd14a1Img = myd14a1.filterDate(startDateAF, endDateAF);<br><br><strong>var</strong> getFireMask = <strong>function</strong>(image) {<br>&nbsp; &nbsp; // Fire Mask (FireMask): values ≥ 7 are active fire pixels <br>&nbsp; &nbsp; <strong>return</strong> image.select('FireMask').gte(7);<br>};<br><br><strong>var</strong> getMaxFRP = <strong>function</strong>(image) {<br>&nbsp; &nbsp; // FRP (MaxFRP): MaxFRP needs to be scaled by 0.1 to be in units of MW.<br>&nbsp; &nbsp; <strong>return</strong> image.select('MaxFRP').multiply(0.1);<br>};<br><br>// Define the active fire mask (count of active fire pixels).<br><strong>var</strong> mod14a1ImgMask = mod14a1Img.map(getFireMask).sum();<br><strong>var</strong> myd14a1ImgMask = myd14a1Img.map(getFireMask).sum();<br><br>// Define the total FRP (MW).<br><strong>var</strong> mod14a1ImgFrp = mod14a1Img.map(getMaxFRP).sum();<br><strong>var</strong> myd14a1ImgFrp = myd14a1Img.map(getMaxFRP).sum();</span></pre>
</li>
<li><span><img src="$IMS-CC-FILEBASE$/Uploaded%20Media/Screenshot%202023-11-16%20at%206.01.14%E2%80%AFAM.png" alt="Screenshot 2023-11-16 at 6.01.14 AM.png" data-api-endpoint="https://ufl.instructure.com/api/v1/courses/489224/files/82983788" data-api-returntype="File" loading="lazy"></span></li>
<li>
<h5><strong>MODIS Burned Area Product</strong></h5>
<p><span>The gridded 500 m MODIS burned area dataset, MCD64A1, is monthly with global coverage but can be disaggregated to daily resolution with its burn date variable (Giglio et al. 2016; Humber et al. 2018). Here we define a function to retrieve the burn date.</span></p>
</li>
<li>
<pre><span>// ------------------------------<br>// 3. MODIS burned area dataset<br>// ------------------------------<br>// MCD64A1 = MODIS/Terra and Aqua combined burned area<br>// resolution: monthly, gridded at 500m in sinusoidal projection (SR-ORG:6974),<br>// can be disaggregated to daily resolution<br>// variables: burn date as day of year (BurnDate)<br><br>// Define the Earth Engine paths for MCD64A1, collection 6.<br><strong>var</strong> mcd64a1 = ee.ImageCollection('MODIS/006/MCD64A1');<br><br><strong>var</strong> getBurnDate = <strong>function</strong>(image) {<br>&nbsp; &nbsp; // burn day of year (BurnDate)<br>&nbsp; &nbsp; <strong>return</strong> image.select('BurnDate');<br>};<br><br>// Define the burned area mask.<br><strong>var</strong> mcd64a1Img = mcd64a1.filterDate(startDateBA, endDateBA);<br><strong>var</strong> mcd64a1ImgMask = mcd64a1Img.map(getBurnDate).min();</span></pre>
</li>
<li>
<h5><strong>GOES Active Fire Products</strong><strong> </strong></h5>
<p><span>The gridded 2 km GOES-16 (East) and GOES-17 (West) active fire datasets cover North and South America in the full disk version (FDCF) with a temporal revisit rate of 15-minute increments (Hall et al. 2019; Schroeder et al. 2008). The two GOES satellites are operated by the National Oceanic and Atmospheric Administration (NOAA) and are primarily used for meteorological monitoring. Note that the pixel orientation and shape differ between GOES-16 and GOES-17 because of the different viewing angles of the two satellites.</span></p>
</li>
<li>
<pre><span>// ------------------------------<br>// 4. GOES 16/17 active fires<br>// ------------------------------<br>// GOES-16/17 - geostationary satellites over North/South America<br>// resolution: every 10-30 minutes, 2 km<br>// variables: fire mask (Mask), FRP (Power)<br><br>// Define the Earth Engine paths for GOES-16/17.<br><strong>var</strong> goes16 = ee.ImageCollection('NOAA/GOES/16/FDCF');<br><strong>var</strong> goes17 = ee.ImageCollection('NOAA/GOES/17/FDCF');<br><br><strong>var</strong> filterGOES = ee.Filter.calendarRange(0, 0, 'minute');<br><br>// Filter the datasets according to the date range.<br><strong>var</strong> goes16Img = goes16.filterDate(startDateAF, endDateAF)<br>&nbsp; &nbsp; .filter(filterGOES);<br><strong>var</strong> goes17Img = goes17.filterDate(startDateAF, endDateAF)<br>&nbsp; &nbsp; .filter(filterGOES);<br><br><strong>var</strong> getFireMask = <strong>function</strong>(image) {<br>&nbsp; &nbsp; // fire mask (Mask): values from 10-35 are active fire pixels,<br>&nbsp; &nbsp; // see the description for QA values to filter out low confidence fires<br>&nbsp; &nbsp; <strong>return</strong> image.select('Mask').gte(10).and(image.select('Mask')<br>&nbsp; &nbsp; &nbsp; &nbsp; .lte(35));<br>};<br><br><strong>var</strong> getFRP = <strong>function</strong>(image) {<br>&nbsp; &nbsp; // FRP (Power), in MW<br>&nbsp; &nbsp; <strong>return</strong> image.select('Power');<br>};<br><br>// Define the active fire mask (count of active fire pixels).<br><strong>var</strong> goes16ImgMask = goes16Img.map(getFireMask).sum();<br><strong>var</strong> goes17ImgMask = goes17Img.map(getFireMask).sum();<br><br>// Define the total FRP (MW).<br><strong>var</strong> goes16ImgFrp = goes16Img.map(getFRP).sum();<br><strong>var</strong> goes17ImgFrp = goes17Img.map(getFRP).sum();</span></pre>
</li>
<li>
<p><span>Now, we will visualize the three datasets, along with the reference Bobcat Fire perimeter, and plot the layers on the Earth Engine interactive map.</span></p>
</li>
<li>
<pre><span>// -------------------------------<br>// 5. Map Visualization - Layers<br>// -------------------------------<br>// Use the 'Layers' dropdown menu on the map panel to toggle on and off layers.<br>Map.addLayer(mod14a1ImgMask.selfMask(), {<br>&nbsp; &nbsp; palette: 'orange'<br>}, 'MOD14A1');<br>Map.addLayer(myd14a1ImgMask.selfMask(), {<br>&nbsp; &nbsp; palette: 'red'<br>}, 'MYD14A1');<br><br>Map.addLayer(mcd64a1ImgMask.selfMask(), {<br>&nbsp; &nbsp; palette: 'black'<br>}, 'MCD64A1');<br><br>Map.addLayer(goes16ImgMask.selfMask(), {<br>&nbsp; &nbsp; palette: 'skyblue'<br>}, 'GOES16', <strong>false</strong>);<br>Map.addLayer(goes17ImgMask.selfMask(), {<br>&nbsp; &nbsp; palette: 'purple'<br>}, 'GOES17', <strong>false</strong>);<br><br>Map.setCenter(lon, lat, 9);</span></pre>
</li>
<li><span><img src="$IMS-CC-FILEBASE$/Uploaded%20Media/Screenshot%202023-11-16%20at%206.04.01%E2%80%AFAM.png" alt="Screenshot 2023-11-16 at 6.04.01 AM.png" data-api-endpoint="https://ufl.instructure.com/api/v1/courses/489224/files/82983794" data-api-returntype="File" loading="lazy"></span></li>
<li>
<p><span>We can also visualize the datasets side by side by using the </span><span>ui</span><span>.</span><span>Panel</span><span> and </span><span>ui</span><span>.</span><span>Map.Linker.</span></p>
</li>
<li>
<pre><span>// ------------------------------------<br>// 6. Map Visualization - Panel Layout<br>// ------------------------------------<br><br>// Define the panel layout.<br><strong>var</strong> panelNames = [<br>&nbsp; &nbsp; 'MODIS active fires', // panel 0 - top left<br>&nbsp; &nbsp; 'MODIS burned area', // panel 1 - bottom left<br>&nbsp; &nbsp; 'GOES active fires', // panel 2 - top right<br>&nbsp; &nbsp; 'Reference' // panel 3 - bottom right<br>];<br><br>// Create a map for each visualization option.<br><strong>var</strong> maps = [];<br>panelNames.forEach(<strong>function</strong>(name, index) {<br>&nbsp; &nbsp; <strong>var</strong> map = ui.Map();<br>&nbsp; &nbsp; map.setControlVisibility({<br>&nbsp; &nbsp; &nbsp; &nbsp; fullscreenControl: <strong>false</strong><br>&nbsp; &nbsp; });<br><br>&nbsp; &nbsp; <strong>if</strong> (index === 0) {<br>&nbsp; &nbsp; &nbsp; &nbsp; map.addLayer(mod14a1ImgMask.selfMask(), {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; palette: 'orange'<br>&nbsp; &nbsp; &nbsp; &nbsp; }, 'MOD14A1');<br>&nbsp; &nbsp; &nbsp; &nbsp; map.addLayer(myd14a1ImgMask.selfMask(), {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; palette: 'red'<br>&nbsp; &nbsp; &nbsp; &nbsp; }, 'MYD14A1');<br>&nbsp; &nbsp; &nbsp; &nbsp; map.add(ui.Label(panelNames[0], {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fontWeight: 'bold',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; position: 'bottom-left'<br>&nbsp; &nbsp; &nbsp; &nbsp; }));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <strong>if</strong> (index == 1) {<br>&nbsp; &nbsp; &nbsp; &nbsp; map.addLayer(mcd64a1ImgMask.selfMask(), {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; palette: 'black'<br>&nbsp; &nbsp; &nbsp; &nbsp; }, 'MCD64A1');<br>&nbsp; &nbsp; &nbsp; &nbsp; map.add(ui.Label(panelNames[1], {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fontWeight: 'bold',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; position: 'bottom-left'<br>&nbsp; &nbsp; &nbsp; &nbsp; }));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <strong>if</strong> (index == 2) {<br>&nbsp; &nbsp; &nbsp; &nbsp; map.addLayer(goes16ImgMask.selfMask(), {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; palette: 'skyblue'<br>&nbsp; &nbsp; &nbsp; &nbsp; }, 'GOES16');<br>&nbsp; &nbsp; &nbsp; &nbsp; map.addLayer(goes17ImgMask.selfMask(), {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; palette: 'purple'<br>&nbsp; &nbsp; &nbsp; &nbsp; }, 'GOES17');<br>&nbsp; &nbsp; &nbsp; &nbsp; map.add(ui.Label(panelNames[2], {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fontWeight: 'bold',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; position: 'bottom-left'<br>&nbsp; &nbsp; &nbsp; &nbsp; }));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; <strong>if</strong> (index == 3) {<br>&nbsp; &nbsp; &nbsp; &nbsp; map.addLayer(reference, {}, 'Reference');<br>&nbsp; &nbsp; &nbsp; &nbsp; map.add(ui.Label(panelNames[3], {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fontWeight: 'bold',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; position: 'bottom-left'<br>&nbsp; &nbsp; &nbsp; &nbsp; }));<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; maps.push(map);<br>});<br><br><strong>var</strong> linker = ui.Map.Linker(maps);<br><br>// Make a label for the main title of the app.<br><strong>var</strong> title = ui.Label(<br>&nbsp; &nbsp; 'Visualizing Fire Datasets in Google Earth Engine', {<br>&nbsp; &nbsp; &nbsp; &nbsp; stretch: 'horizontal',<br>&nbsp; &nbsp; &nbsp; &nbsp; textAlign: 'center',<br>&nbsp; &nbsp; &nbsp; &nbsp; fontWeight: 'bold',<br>&nbsp; &nbsp; &nbsp; &nbsp; fontSize: '24px'<br>&nbsp; &nbsp; });<br><br>// Define a map grid of 2x2 sub panels.<br><strong>var</strong> mapGrid = ui.Panel(<br>&nbsp; &nbsp; [<br>&nbsp; &nbsp; &nbsp; &nbsp; ui.Panel([maps[0], maps[1]], <strong>null</strong>, {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stretch: 'both'<br>&nbsp; &nbsp; &nbsp; &nbsp; }),<br>&nbsp; &nbsp; &nbsp; &nbsp; ui.Panel([maps[2], maps[3]], <strong>null</strong>, {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stretch: 'both'<br>&nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; ],<br>&nbsp; &nbsp; ui.Panel.Layout.Flow('horizontal'), {<br>&nbsp; &nbsp; &nbsp; &nbsp; stretch: 'both'<br>&nbsp; &nbsp; }<br>);<br>maps[0].setCenter(lon, lat, zoom);<br><br>// Add the maps and title to the ui.root().<br>ui.root.widgets().reset([title, mapGrid]);<br>ui.root.setLayout(ui.Panel.Layout.Flow('vertical'))</span></pre>
</li>
<li><span><img src="$IMS-CC-FILEBASE$/Uploaded%20Media/Screenshot%202023-11-16%20at%206.06.31%E2%80%AFAM.png" alt="Screenshot 2023-11-16 at 6.06.31 AM.png" data-api-endpoint="https://ufl.instructure.com/api/v1/courses/489224/files/82983798" data-api-returntype="File" loading="lazy"></span></li>
</ol>
<div id="gtx-trans" style="position: absolute; left: 71px; top: 1549.22px;"></div>
</body>
</html>